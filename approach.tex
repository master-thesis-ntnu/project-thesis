\chapter{Approach}
\label{ch:approach}
This chapter describes how the search was conducted and all the assumptions which were taken.

\section{Dataset}
[Flickr API]

\section{Search Implementation}

One of the main goal in this project thesis was to achieve lower latency and better scaleability compared to the KL search implemented in the master thesis done by Rudihagen \cite{master-thesis}.
The experiment's performance measure was latency.

Figure \ref{fig:sequence-diagram-search} shows the experiments sequence diagram.
First the a HTTP request arrives the web server.
The search terms are extracted and from the users query.
In this experiment, the extracted terms are searched against photo hastags.
The query sent to Elasticsearch can be seen in Appendix \ref{es-query-inital-search}.
An aggregation is added to the query as the data is needed later to calculate the KL score.

From Elasticsearch all the top k documents are returned together with an hashtag aggregation.
The aggregation contains each hashtag with its corresponding document count.
However this count are all the occurences of the hashtag, and not the count of the top k document.
Hashtag count from the top k documents are calculated from the returned photos.
Using Equation \ref{kl-distance-sym} all hashtags are scored.
The top 10 hashtags are used as search terms.

After calculating the new search terms, a new query are sent to Elasticsearch.
The result from the second query are sent directly to back to the user.

[Add Elasticsearch initial result query]
[Add elasticsearch query]
[Add photo data structure]

\begin{figure}[h!]
\centering \includegraphics[width=0.9\linewidth]{img/sequence-diagram-search.png}
\caption{Sequence diagram for the search experiment}
\label{fig:sequence-diagram-search}
\end{figure}
